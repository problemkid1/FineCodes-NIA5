@model CRMProject.Models.Industry

@{
    ViewData["Title"] = "Create";
}

<!-- Display Success or Error Messages -->
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success" role="alert">
        @TempData["SuccessMessage"]
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger" role="alert">
        @TempData["ErrorMessage"]
    </div>
}

<div class="col-12">
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h2>Create Industry</h2>
        </div>
        <div class="card-body">
            <form asp-action="Create">
                <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
                <div class="columns">
                    <!-- Industry NAICS Code -->
                    <div class="col-12 col-md-6">
                        <div class="form-group">
                            <label asp-for="IndustryNAICSCode" class="control-label">
                                <span class="text-danger">*</span>Industry NAICS Code
                            </label>
                            <input asp-for="IndustryNAICSCode" class="form-control" placeholder="Enter new NAICS Code" required />
                            <span asp-validation-for="IndustryNAICSCode" class="text-danger"></span>
                        </div>
                    </div>
                
                
                    <!-- Industry Sector -->
                    <div class="col-12 col-md-6">
                        <div class="form-group">
                            <label asp-for="IndustrySector" class="control-label">
                                <span class="text-danger">*</span> Industry Sector
                            </label>
                            <select id="IndustrySector" name="IndustrySector" class="form-control" required>
                                <option value="">All Sectors</option>
                                @foreach (var item in ViewBag.SectorList)
                                {
                                    <option value="@item.Value">@item.Text</option>
                                }
                            </select>
                            <span asp-validation-for="IndustrySector" class="text-danger"></span>
                            <input type="text" id="NewIndustrySector" class="form-control mt-2" placeholder="Enter new Sector">
                            <button type="button" id="AddIndustrySector" class="btn btn-primary mt-2">Add New Sector</button>
                        </div>
                    </div>                    

                    <!-- Industry Subsector -->
                    <div class="col-12 col-md-6">
                        <div class="form-group">
                            <label asp-for="IndustrySubsector" class="control-label">
                                <span class="text-danger">*</span> Industry Subsector
                            </label>
                            <select id="IndustrySubsector" name="IndustrySubsector" class="form-control" required>
                                <option value="">All Subsector</option>
                                @foreach (var item in ViewBag.SubsectorList)
                                {
                                    <option value="@item.Value">@item.Text</option>
                                }
                            </select>
                            <span asp-validation-for="IndustrySubsector" class="text-danger"></span>
                            <input type="text" id="NewIndustrySubsector" class="form-control mt-2" placeholder="Enter new Subsector">
                            <button type="button" id="AddIndustrySubsector" class="btn btn-primary mt-2">Add New Subsector</button>
                        </div>
                    </div>
                </div>
                

                <div class="form-group text-center">
                    <input type="submit" value="Create Industry" class="btn btn-primary" />
                    <a asp-action="Index" class="btn btn-secondary ml-2">Back to Industries</a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            // Function to handle adding new options
            function addNewOption(inputId, selectId, alertMessage) {
                var newValue = document.getElementById(inputId).value.trim();
                var selectBox = document.getElementById(selectId);

                if (newValue === "") {
                    alert("Please enter " + alertMessage + " before adding.");
                    return;
                }

                // Check if it already exists in the dropdown
                for (var i = 0; i < selectBox.options.length; i++) {
                    if (selectBox.options[i].value === newValue) {
                        alert(alertMessage + " already exists in the list.");
                        return;
                    }
                }

                // Create a new option and add it to the select list
                var newOption = document.createElement("option");
                newOption.value = newValue;
                newOption.text = newValue;
                newOption.selected = true; // Select it automatically
                selectBox.appendChild(newOption);

                // Clear the input field
                document.getElementById(inputId).value = "";
            }

            // Attach event listeners to the buttons
            document.getElementById("AddIndustrySector").addEventListener("click", function () {
                addNewOption("NewIndustrySector", "IndustrySector", "Industry Sector");
            });

            document.getElementById("AddIndustrySubsector").addEventListener("click", function () {
                addNewOption("NewIndustrySubsector", "IndustrySubsector", "Industry Subsector");
            });

        });
    </script>


}
